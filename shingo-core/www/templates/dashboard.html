{{define "content"}}
<div data-sse="dashboard">
  <h1 class="mb-2">Dashboard</h1>

  <div class="grid grid-6 mb-1">
    <div class="card stat">
      <div class="value">{{.TotalOrders}}</div>
      <div class="label">Active Orders</div>
    </div>
    <div class="card stat">
      <div class="value">{{.TotalNodes}}</div>
      <div class="label">Total Nodes</div>
    </div>
    <div class="card stat">
      <div class="value">
        <span id="fleet-status" class="health {{if .FleetOK}}health-ok{{else}}health-fail{{end}}"></span>
        {{if .FleetOK}}OK{{else}}Down{{end}}
      </div>
      <div class="label">Fleet Manager ({{.FleetName}})</div>
    </div>
    <div class="card stat">
      <div class="value">
        <span id="msg-status" class="health {{if .MessagingOK}}health-ok{{else}}health-fail{{end}}"></span>
        {{if .MessagingOK}}OK{{else}}Down{{end}}
      </div>
      <div class="label">Messaging</div>
    </div>
    <div class="card stat">
      <div class="value">
        <span id="redis-status" class="health {{if .RedisOK}}health-ok{{else}}health-fail{{end}}"></span>
        {{if .RedisOK}}OK{{else}}Down{{end}}
      </div>
      <div class="label">Redis</div>
    </div>
    <div class="card stat">
      <div class="value">{{.PollerActive}}</div>
      <div class="label">Polling Orders</div>
    </div>
  </div>
  <div class="text-muted mb-3" style="font-size:0.8rem;text-align:right;">SSE clients: {{.SSEClients}}</div>

  {{if .ActiveOrders}}
  <div class="card">
    <h3>Active Orders</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Station</th>
          <th>Type</th>
          <th>Payload Type</th>
          <th>Status</th>
          <th>Robot</th>
          <th>Created</th>
        </tr>
      </thead>
      <tbody>
        {{range .ActiveOrders}}
        <tr>
          <td><a href="/orders/detail?id={{.ID}}">{{.ID}}</a></td>
          <td>{{.StationID}}</td>
          <td>{{.OrderType}}</td>
          <td>{{if .PayloadTypeID}}PT#{{deref .PayloadTypeID}}{{else}}{{.MaterialCode}}{{end}}</td>
          <td><span class="badge badge-{{.Status}}">{{.Status}}</span></td>
          <td>{{.RobotID}}</td>
          <td>{{formatTime .CreatedAt}}</td>
        </tr>
        {{end}}
      </tbody>
    </table>
  </div>
  {{else}}
  <div class="card">
    <p class="text-muted">No active orders.</p>
  </div>
  {{end}}
</div>
{{end}}
